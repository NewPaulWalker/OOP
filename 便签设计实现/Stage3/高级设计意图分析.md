## 高级设计意图分析

我们之前熟悉的程序多为面向过程的，以过程为中心，进行算法分解。即`程序=算法+数据结构`。面向过程的软件系统，其算法和数据结构相对固定，难以变更。

而面向对象则是对现实世界的模拟。即`程序=对象+交互`。其中共性的抽象更容易被复用，稳定的中间状态更容易演进。

在上一次作业中已经对该便签设计的核心设计流程做了一个较为朴素的说明，这次因为设计还未完全实现，故主要想讨论一下便签设计中体现出的设计模式，看看便签设计中是如何体现复用和演进的。

##### 注：因为便签设计还需要再做一些修改和功能添加，以及移植性的完善，故代码与最终结果将会在考试周结束后的最后一次commit中给出。



### SOLID五原则

一个好的设计应该遵循SOLID五原则，即单一职责、开放封闭、里氏替换、接口隔离和依赖倒转。



* 单一职责：一个类有且只有一个引起变化的因素。一个类只完成它应该完成的职责，才能做到高内聚。

因为我的便签设计使用的是MVC的设计理念。对于需要完成的一个事务，需要三个方面：模型、控制器和视图来同时参与。三个层次各司其职，只完成它应该完成的那部分职责。



* 开放封闭：对扩展开放，对修改封闭。已有代码不用变，就可以添加新功能。

在我的便签设计中，新建、编辑、保存以及之后可能需要实现的收藏等动作，都是一个便签类中的方法。那么在需要添加对便签的新操作时，就不需要改变之前已经实现好的方法，而只用在这个便签类中添加一个新方法就行。因为这些方法都是对便签实体的一个更改，它们需要放在同一个类中。



* 里氏替换：子类可以替代它的父类。在同一个继承体系中的对象应该有共同的行为特征，发挥父类编程和多态的优势。

正如在第二次作业中提到的，父类的便签类可以只是一个很普通的类，而为了添加一些扩展功能，则可以靠子类继承父类的共性，并增加自己的特性来实现。如最基本的便签父类只能完成基本的文本编辑，那么可以设计不同的子类继承父类的文本编辑功能，同时增加插入图片、视频，或者支持`Markdown`，这些新的子类都可以替代它的父类，因为它们都支持最基本的文本编辑功能。



* 接口隔离：一个类对另一个类的依赖建立在最小的接口上。尽量细化接口，为各个类建立专用的接口，而不是试图去建立一个庞大而臃肿的接口提供所有依赖于他的类去调用。

这个问题可能是我的设计，或者说web应用中的一大缺陷。因为web应用从浏览器发起请求后，经过路由系统来找到并调用需要的方法的。而路由就需要认识所有的类，也就是说路由系统和接口隔离的理念似乎是相悖的。我能做的只能是减少对一次方法调用中需要的两个类的依赖。



* 依赖倒转：高层模块不依赖于底层模块，两者应依赖于抽象。抽象不依赖于细节，细节应该依赖于抽象。要依赖于抽象，而不是依赖于具体实现。

面向过程的开发中，上层调用下层。当下层变动时，上层也要跟着变动。这会导致模块的复用性降低。而面向对象的开发中，主要是面向抽象来编程。只要抽象没变，就可以继续复用。与具体实现没有关系。

在便签设计中，很多地方都能够体现依赖倒转。如编辑完后需要保存便签时，我高层需要的仅仅只是一个保存的动作。我只需要有保存的一个抽象即可，至于它是保存进数据库，还是通过流写到文本中，这些具体实现则不是便签需要考虑的，而是具体编写这个动作的代码时需要考虑的。



### 设计模式

模式的核心思想是通过增加抽象层，把变化部分从不变部分中分离出来。

#### 一、工厂方法模式

工厂方法是为了定义一个用于创建对象的接口，让子类决定实例化哪一个类。其将实例化类延迟到了子类中进行。

如便签设计中，编辑界面可以选择用富文本编辑器，也可以使用`Markdown`的解释界面。但是对于一个便签来说，究竟要使用哪一种编辑界面，是需要在运行时决定的。工厂方法模式针对接口编程，就可以排除许多可能发生的变化。这里体现了SOLID中的开放封闭原则。

静态工厂方法创建类时需要根据传入的参数，这就会引起工厂类的代码的变化。这就与开放封闭原则相违背。这时为了实现增加新功能而不影响已有代码，可以针对不同产品提供不同的工厂，不同级别的工厂负责创建不同等级的产品。

#### 二、单例模式

单例模式保证一个类仅有一个实例，并提供一个访问它的全局访问点。

一个保证一个类只有一个实例化的方法是让类自身负责保存它的唯一实例。这个类可以保证可以保证没有其他实例可以被创建，并且可以提供一个访问该实例的方法。

在我的web便签中，`servlet`在容器中就是单例模式存在的，只会创建一个。每次浏览器端发送请求到容器后，容器并不会重新实例化一个`servlet`，而是从线程池中分配一个线程给这个请求，请求完毕之后将线程回收到线程池中。

以及MVC的便签设计中的控制器，就可以利用单例模式来进行设计，这样的一个全局对象有利于我们控制全局，沟通`model`和`view`，以及分派用户的请求和选择适当的视图。



### 总结

总之，这些设计原则能够很好地帮助我们对设计做出调整，以获得更好的结果。而设计模式相当于遵循一定设计原则的模板，我们按照这些模板就可以实现上述的设计原则，进而得到一个较好的结果。尽管目前的便签确实非常简单，体现不出太多的设计模式和设计原则，但是设计模式和设计原则还是在我写代码中发挥了一个很好的指导作用。
